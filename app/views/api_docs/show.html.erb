<div class="page-header">
  <h1>API Documentation</h1>
</div>

<div class="swagger-section">
  <!--<div id='header'>
    <div class="swagger-ui-wrap">
      <a id="logo" href="http://swagger.io">swagger</a>
      <form id='api_selector'>
        <div class='input'><input placeholder="http://example.com/api" id="input_baseUrl" name="baseUrl" type="text"/></div>
        <div class='input'><input placeholder="api_key" id="input_apiKey" name="apiKey" type="text"/></div>
        <div class='input'><a id="explore" href="#">Explore</a></div>
      </form>
    </div>
  </div>-->
  
  <div id="message-bar" class="swagger-ui-wrap">&nbsp;</div>
  <div id="swagger-ui-container" class="swagger-ui-wrap"></div>
</div>

<div>
  <hr />
  <p class="text-center">
    <strong>Warning!</strong> This API is under construction, breaking changes may occur.
  </p>
</div>

<script type="text/javascript">
  $(function () {
    window.swaggerUi = new SwaggerUi({
      url: "<%= request.protocol + request.host_with_port + root_path + 'api/docs/v1/api-docs.json' %>",
      dom_id: "swagger-ui-container",
      supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
      onComplete: function(swaggerApi, swaggerUi){
        if(typeof initOAuth == "function") {
          // Hardcode authorization info here, because fuck it
          swaggerApi.authSchemes = {
            'oauth2': {
              'type': 'oauth2',
              'scopes': [],
              'grantTypes': {
                'implicit': {
                  'loginEndpoint': {
                    'url': '<%= oauth_authorization_url %>'
                  },
                  'tokenName': 'access_token'
                }
              }
            }
          };
          
          initOAuth({
            clientId: "394454040543ad552a9d39a0dd1ff0b659bd9dbeaa1cd22d0c4dbc1d5ea564e7",
            realm: "Doorkeeper",
            appName: "Documentation"
          });
        }
        
        $('pre code').each(function(i, e) {
          hljs.highlightBlock(e);
        });
        
        // Swagger defaults to assigning the 'container' class to this, which
        // conflicts with the bootstrap class with the same name
        // $('#resources_container').removeClass('container');
      },
      onFailure: function(data) {
        log("Unable to Load SwaggerUI");
      },
      docExpansion: "none",
      sorter : "alpha"
    });
    
    function addApiKeyAuthorization() {
      var key = encodeURIComponent($('#input_apiKey')[0].value);
      log("key: " + key);
      if(key && key.trim() != "") {
          var apiKeyAuth = new SwaggerClient.ApiKeyAuthorization("api_key", key, "query");
          window.swaggerUi.api.clientAuthorizations.add("api_key", apiKeyAuth);
          log("added key " + key);
      }
    }
    $('#input_apiKey').change(addApiKeyAuthorization);
    
    // if you have an apiKey you would like to pre-populate on the page for demonstration purposes...
    /*
      var apiKey = "myApiKeyXXXX123456789";
      $('#input_apiKey').val(apiKey);
      addApiKeyAuthorization();
    */
    
    window.swaggerUi.load();
    function log() {
      if ('console' in window) {
        console.log.apply(console, arguments);
      }
    }
});
</script>
